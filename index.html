<!DOCTYPE html>
<html lang="en-US" class="no-js">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

  <head>
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />

    <title>TBRR</title>

    <!-- <link
      rel="stylesheet"
      id="combined-css"
      href="tbrr public\Main\tbrr\css\combined.min662c.css"
      media="all"
    /> -->
    <link 
    rel="stylesheet"
    href="tbrr public\Main\tbrr\tbrr custom.css"
    media="all"
    />
    <link
      rel="stylesheet"
      id="kmain/tbrr-style-css"
      href="tbrr public/Main/tbrr/style8a54.css?ver=1.0.0"
      media="all"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
    />

    <link rel="stylesheet" href="./tbrr public/Main/tbrr/css/tbrr custom.css" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="./tbrr public/Main/tbrr/css/bootstrap.min.css"
    />
    <!-- Fontawesome -->
    <link rel="stylesheet" href="tbrr public/Main/tbrr/css/fontawesome.css" />
    <!-- Flaticon -->
    <link rel="stylesheet" href="tbrr public/Main/tbrr/css/flaticon.css" />
    <!-- optico Icons -->
    <link
      rel="stylesheet"
      href="tbrr public/Main/tbrr/css/pbminfotech-base-icons.css"
    />
    <!-- Themify Icons -->
    <link rel="stylesheet" href="tbrr public/Main/tbrr/css/themify-icons.css" />
    <!-- Base CSS -->
    <link rel="stylesheet" href="tbrr public/Main/tbrr/css/base.css" />
    <!-- Style CSS -->
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="tbrr public/Main/tbrr/css/responsive.css" />

    <!-- hhh -->

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="images/homepage-1/favicon.png"
    />

    <style>
      #map {
        height: 900px;
      }

      .leaflet-popup-content {
        max-height: 300px;
        overflow-y: auto;
      }

      .list-container,
      .pbmit-all-post-list {
        font-size: 10px;
        font-weight: bold;
        font-family: PPNeueMontreal-Medium, sans-serif;
      }

      .active-region,
      .active-woreda,
      .active-kebele,
      .active-site {
        background-color: rgb(0, 96, 74);
        color: white;
      }

      .s-lists {
        border: 1px solid rgb(206, 210, 200);
        border-radius: 5px;
        box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);
      }

      .s-content .s-search {
        position: relative;
      }

      .s-search i {
        position: absolute;
        line-height: 30px;
        color: #999;
        left: 10px;
      }

      .s-search input {
        width: 100%;
        outline: none;
        font-size: 11px;
        font-weight: 400;
        padding: 5px 15px 5px 40px;
        border: solid 1px rgb(133, 200, 33);
        border-radius: 5px;
      }

      .s-content ul {
        margin-top: 10px;
        max-height: 200px;
        overflow-y: auto;
      }

      .s-content ul::-webkit-scrollbar {
        width: 5px;
      }

      .s-content ul::-webkit-scrollbar-track {
        background-color: #f1f1f1;
        border-radius: 20px;
        margin: 5px 3px;
      }

      .s-content ul::-webkit-scrollbar-thumb {
        background-color: #ccc;
        border-radius: 20px;
      }

      .s-content ul li:hover {
        background-color: #f2f2f2;
        color: #000;
      }

      .s-hide {
        display: none;
      }

      .Nav {
        display: flex;
        align-items: center;
      }

      .logo {
        margin-right: 5%;
      }

      .navigation {
        display: flex;
        padding-left: 5px;
        padding-right: 5px;
        flex-wrap: wrap;
      }

      .mini-nav {
        padding-left: 10px;
        padding-right: 10px;
        width: fit-content;
        margin: 10px;
      }
      .nav-trigger {
        width: 20px;
      }
      .fixed-nav-wrapper {
        width: 300px;
      }
      .accordion-content {
        display: none;
        background-color: white;
        position: absolute;
        width: 150px;
      }

      .accordion-active {
        display: block;
      }
      body.loading .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #fff;
      }
      .loading-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: rgba(255, 255, 255, 0.8);
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .loading-spinner {
        margin-bottom: 20px;
      }
      .render-label {
        font-weight: bold;
        font-size: 12px;
      }
      .render-value {
        font-size: 12px;
      }
    </style>
  </head>
  <body
    class="home page-template-default page page-id-9 header-over-content no-sidebar loading"
  >
    <div class="loading-container">
      <div class="loading-spinner d-flex justify-content-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 100 100"
          preserveAspectRatio="xMidYMid"
          width="60"
          height="60"
          style="shape-rendering: auto; display: block; background: transparent"
        >
          <circle
            cx="50"
            cy="50"
            r="35"
            stroke="#00604a"
            stroke-width="10"
            fill="none"
            stroke-dasharray="164.93361431346415 56.97787143782138"
          >
            <animateTransform
              attributeName="transform"
              type="rotate"
              values="0 50 50;360 50 50"
              dur="1s"
              repeatCount="indefinite"
            ></animateTransform>
          </circle>
        </svg>
      </div>
      <strong>Please Wait...</strong>
    </div>

    <header>
      <div class="container-fluid native-padding">
        <div class="row">
          <div class="Nav">
            <a href="/">
              <div class="logo-full">
                <img
                  src="tbrr public/Main/tbrr/img/tbrrlogo/tbrrlogo1.jpg"
                  height="45px"
                  width="45px"
                  alt=" Logo"
                />
                Tree based Restoration Registry
              </div>
            </a>
            <div class="navigation">
              <a href="/" class="mini-nav">
                <div>Interactive map</div>
              </a>
              <a href="Aboutr.html" class="mini-nav">
                <div>About the Registry</div>
              </a>
              <a href="Aboutsf.html" class="mini-nav">
                <div>About the Fund</div>
              </a>
              <a href="/" class="mini-nav" id="faq">
                <div>FAQ</div>
              </a>
              <a href="/" class="mini-nav">
                <div>Contact</div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="fixed-nav-wrapper">
      <div class="nav-trigger" id="nav-trigger">
        <span>Filters</span><i></i>
      </div>
    </div>

    <div id="main-nav-overlay-wrapper" class="container-fluid px-0 is-active">
      <div class="row mx-0 d-flex align-content-end overlay-inner">
        <div
          class="col-12 h-100 px-0 d-flex flex-column flex-nowrap mobile-nav-outer"
        >
          <div class="top-item-wrapper mt-sidebar-5">
            <div class="card card-body">
              <div class="row g-1">
                <div class="col-md-3">
                  <div
                    class="container region-container px-5 pt-2 wrapper"
                    id="regionContainer"
                  >
                    <div
                      class="d-flex justify-content-between align-content-center arrow"
                      id="selectBtn"
                    >
                      <h6>Select region</h6>
                      <i class="fa fa-caret-down pt-2"></i>
                    </div>
                    <div class="s-content">
                      <div class="s-search">
                        <i class="fa fa-search"></i>
                        <input
                          type="text"
                          placeholder="Search"
                          id="searchInput"
                        />
                      </div>
                      <ul
                        class="pbmit-all-post-list container s-lists"
                        id="regionList"
                      ></ul>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div
                    class="container woreda-container px-5 pt-2"
                    id="woredaContainer"
                  >
                    <div class="s-hide arrow" id="woredaBtn">
                      <h6>Select woreda</h6>
                    </div>
                    <div class="s-content s-hide" id="woredaContent">
                      <div class="s-search">
                        <i class="fa fa-search"></i>
                        <input
                          type="text"
                          placeholder="Search"
                          id="woredaInput"
                        />
                      </div>
                      <ul
                        class="pbmit-all-post-list container s-lists"
                        id="woredaList"
                      ></ul>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div
                    class="container kebele-container px-5 pt-2"
                    id="kebeleContainer"
                    style="display: none"
                  >
                    <div class="arrow">
                      <h6>Select kebele</h6>
                    </div>
                    <div class="s-content" id="woredaContent">
                      <div class="s-search">
                        <i class="fa fa-search"></i>
                        <input
                          type="text"
                          placeholder="Search"
                          id="kebeleInput"
                        />
                      </div>
                      <ul
                        class="pbmit-all-post-list container s-lists"
                        id="kebeleList"
                      ></ul>
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div
                    class="container site-container px-5 pt-2"
                    id="siteContainer"
                    style="display: none"
                  >
                    <div class="arrow">
                      <h6>Select site</h6>
                    </div>
                    <div class="s-content" id="woredaContent">
                      <div class="s-search">
                        <i class="fa fa-search"></i>
                        <input
                          type="text"
                          placeholder="Search"
                          id="siteInput"
                        />
                      </div>
                      <ul
                        class="pbmit-all-post-list container s-lists"
                        id="siteList"
                      ></ul>
                    </div>
                  </div>
                </div>
              </div>
              <br />
            </div>
<div style="display: flex;">
  <div id="geo" style="margin-left: auto; margin-right: 20px;"></div>
</div>
          <br />
            <div class="container project-container">
              <div class="card">
                <div class="card-header">
                  <h6 class="card-title">Detailed location Information</h6>
                </div>
                <div
                  class="card-body overflow-auto projectInfo"
                >
                  Explore detailed location information by selecting a region
                  and other criteria using the filters above. Simply click on
                  the filter navigation to refine your search and access
                  comprehensive data.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br /><br />

    <div class="content-wrapper">
      <br />
      <div class="row">
        <div class="col-12 col-sm-10 col-md-8 col-xl-12">
          <div class="intro-title">
            <h2 class="m-lg-5">
              Welcome to <span>Tree based Restoration Registry (TBRR)</span>
            </h2>
          </div>
          <div class="col-12 col-sm-12 col-md-12 col-xl-10 m-lg-5">
            This web-based interactive map and database serve as a guide to
            pinpointing degraded sites across Ethiopia. Here, you'll find a
            wealth of detailed information essential for identifying,
            monitoring, and rehabilitating these landscapes, playing a pivotal
            role in environmental restoration and fostering long-term
            sustainability.
          </div>
        </div>
      </div>
      <br /><br />
      <div class="row">
        <div class="col-md-9">
          <img
            src="tbrr public/Main/tbrr/img/icons/zoom-out.png"
            height="30px"
            id="Zoom_Out"
            alt="Zoom Out Icon"
          />
          <div id="map"></div>
        </div>
        <div class="col-md-3 mt-5">
          <div class="container project-container">
            <div class="card">
              <div class="card-header">
                <h6 class="card-title">Detailed location Information</h6>
              </div>
              <div
                class="card-body overflow-auto projectInfo"
                style="height: 800px"
              >
                Explore detailed location information by selecting a region and
                other criteria using the filters above. Simply click on the
                filter navigation to refine your search and access comprehensive
                data.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />

    <footer>
      <div class="container-fluid native-padding">
        <div class="row">
          <div class="col-12">
            <div class="footer-top">
              <div class="row">
                <div class="col-xl-12">
                  <div>
                    <h6 class="strong">Disclaimer</h6>
                    <p class="indented smaller">
                      The information presented on the registry is sourced from
                      various stakeholders within Ethiopia, including Regions,
                      Woredas, and Kebeles. While we strive for accuracy and
                      reliability, we cannot guarantee the completeness or
                      timeliness of the content. Ethiopian Forestry Development
                      (EFD) retains all rights to the information provided.
                      Reproduction or distribution of any part of the content
                      without explicit permission is prohibited. Additionally,
                      EFD is not liable for any actions taken based on the
                      information presented on the registry. Users are
                      encouraged to verify details and contact us with any
                      concerns or corrections.
                    </p>
                  </div>
                </div>
              </div>
              <a
                href="contact-kes-dckv//"
                target
                class="d-inline-block d-md-none footer-cta main-btn"
                >Get a Quote</a
              >
            </div>
          </div>
          <div class="col-12 footer-middle">
            <div class="row justify-content-between">
              <div
                class="col-12 col-sm-6 col-lg-auto footer-col-1 omit-last-item-margin"
              >
                <div class="logo-full">
                  <img
                    src="tbrr public/Main/tbrr/img/tbrrlogo/tbrrlogo1.jpg"
                    height="45px"
                    width="45px"
                    alt="Tree based Restoration Registry Logo"
                  />
                </div>
                <div class="h4 color-dark-green">
                  Tree based Restoration Registry
                </div>
                Addis Ababa, Ethiopia<br />
              </div>
              <div class="col-12 col-sm-6 col-lg-auto footer-col-2">
                <div class="h4 color-dark-green">Get in touch</div>
                <ul class="social-links">
                  <li><a href="#" target="_blank">Twitter</a></li>
                  <li><a href="#" target="_blank">LinkedIn</a></li>
                  <li><a href="#" target="_blank">Facebook</a></li>
                </ul>
              </div>
              <div class="col col-sm-6 col-lg-auto footer-col-3 pe-5 pe-md-3">
                <div class="row align-items-center justify-content-between">
                  <div class="col-12">
                    <div class="h4 color-dark-green">Resources</div>
                  </div>
                </div>
              </div>
              <div class="col-auto col-sm-6 col-lg-auto footer-col-4"></div>
            </div>
          </div>
          <div class="col-12 footer-credits">
            <div class="row justify-content-between d-flex align-items-end">
              <div class="col-lg-6">
                Tree based Restoration Registry
                <a href="#" target="_blank">TBRR</a> &copy; 2024. All rights
                reserved.
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script
      src="tbrr js/js/jquery/jquery.minf43b.js?ver=3.7.1"
      id="jquery-core-js"
    ></script>
    <script
      src="tbrr js/js/jquery/jquery-migrate.min5589.js?ver=3.4.1"
      id="jquery-migrate-js"
    ></script>
    <script
      src="tbrr public/Main/tbrr/js/combined.min662c.js?ver=2024.22.02.01"
      id="customscripts-js"
    ></script>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
      window.addEventListener("load", function () {
        document.body.classList.remove("loading");
      });
      const GEO = document.getElementById("geo");
      const thirdOpacity = 0.1;
      const secondaryOpacity = 0.4;
      const mainOpacity = 0.0;
      const ethiopia = { lat: 9.145, lng: 40.4897 };
      const map = L.map("map", {
        minZoom: 5,
        maxBounds: [
          [3.306, 32.897], 
          [15.003, 48.102], 
        ],
        updateWhenIdle: false,
      }).setView(ethiopia, 7);

      L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          attribution: "&copy; OpenStreetMap contributors",
        }
      ).addTo(map);

      function fetchData(url) {
        return fetch(url).then((response) => response.json());
      }

      fetchData("boundary.geojson").then(function (data) {
        L.geoJSON(data, {
          style: {
            fillColor: "#f8f8f8",
            fillOpacity: 1,
            color: "white",
            weight: 1,
          },
        }).addTo(map);
      });
      var regionLayer,
        allSiteLayerGroup = L.layerGroup().addTo(map);
      woredaLayerGroup = L.layerGroup().addTo(map);
      var kebeleLayerGroup = L.layerGroup().addTo(map);
      var siteLayerGroup = L.layerGroup().addTo(map);

      var All_Regions = [];
      var Woredas = [];
      var Kebeles = [];
      var Sites = [],
        Woredas_List = [],
        Kebele_List = [],
        Site_List = [],
        woredaBool = false,
        kebeleBool = false,
        siteBool = false;

      var woredaList = document.getElementById("woredaList");
      var selectWoreda = document.getElementById("woredaBtn");
      var woredaContent = document.getElementById("woredaContent");
      var kebeleList = document.getElementById("kebeleList");
      var siteList = document.getElementById("siteList");

      function SiteMarkerBindToolTip (coordinates,siteIcon, layer, feature, bool) {
       
        var coordinates = layer.getBounds().getCenter();
                      var siteMarker = L.marker(coordinates, {
                        icon: siteIcon,
                      }).addTo(map);

                    siteMarker.bindTooltip(
                        feature.properties.Name
                          ? feature.properties.Name
                          : feature.properties.watershed,
                        {
                          permanent: bool,
                          direction: "top",
                        }
                      );
                      return siteMarker;
      }
      function SiteLayerStyle (layer) {
        layer.setStyle({
                      color: "#ffd790",
                      fillOpacity: secondaryOpacity,
                      weight: 1,
                    });

      }

      fetch("https://tbrr.echnoserve.com/api/geojson/regions")
        .then((response) => response.json())
        .then((data) => {
          const Region_Array = data.data;
          Region_Array.forEach(function (region) {
            fetchData(`https://tbrr.echnoserve.com/${region}`).then(
              (regionData) => {
                All_Regions.push(regionData);
                var regionList = document.getElementById("regionList");
                var searchInput = document.getElementById("searchInput");

                var regions = [];

                regionData.features.forEach((feature) => {
                  feature.properties.id = parseInt(region.match(/\d+/)[0], 10);
                  regions.push({
                    Name: feature.properties.name,
                    id: parseInt(region.match(/\d+/)[0], 10),
                  });
                });

                regions.forEach((region) => {
                  var listItem = document.createElement("li");
                  listItem.textContent = region.Name;
                  regionList.appendChild(listItem);

                  listItem.addEventListener("click", function () {
                    Woredas = [];
                    Kebeles = [];
                    Sites = [];

                    if (kebeleList) {
                      kebeleList.innerHTML = ""
                      kebeleList.style.display = "none";
                    }

                    if (siteList) {
                      kebeleList.innerHTML = ""
                      siteList.style.display = "none";
                    }

                    var selectedRegion = region.id;
                    woredaLayerGroup.clearLayers();
                    regionLayer.resetStyle();
                    var selectedLayer = getLayerByRegionName(selectedRegion);

                    if (selectedLayer) {
                      map.fitBounds(selectedLayer.getBounds());
                      selectedLayer.fire("click");
                    }
                  });
                });

                searchInput.addEventListener("input", function () {
                  var filterValue = searchInput.value.toLowerCase();
                  Array.from(regionList.getElementsByTagName("li")).forEach(
                    function (listItem) {
                      var RegionName = listItem.textContent.toLowerCase();
                      if (RegionName.indexOf(filterValue) > -1) {
                        listItem.style.display = "";
                      } else {
                        listItem.style.display = "none";
                      }
                    }
                  );
                });

                all_Site = [];

                function onEachSiteLayer(feature, layer) {
  layer.id = feature.id;
  all_Site.push(layer);

  var siteIcon = L.icon({
    iconUrl: "tbrr public/Main/tbrr/icons/gps.png",
    iconSize: [32, 32],
    iconAnchor: [16, 16],
  });

  var coordinates = layer.getBounds().getCenter();
  const siteMarker = SiteMarkerBindToolTip(coordinates, siteIcon, layer, feature, false);

  var SITE_ID = feature.id;

  siteMarker.on("click", function () {
  
    var THE_SITE = all_Site.find(
      (LAYER) => LAYER.id === SITE_ID
    );

    SiteLayerStyle(THE_SITE)
    // THE_SITE.setAttribute('stroke', '#e3c172');
    map.fitBounds(THE_SITE.getBounds());
    projectInfo(SITE_ID, "site");
  });

}

                ///////////////
                fetch("https://tbrr.echnoserve.com/api/geojson/sites")
                  .then((response) => response.json())
                  .then((data) => {
                    const Site_array = data.data;
                    Site_array.forEach(function fetchSiteData(site_Url) {
                      return fetch(`https://tbrr.echnoserve.com${site_Url}`)
                        .then((response) => response.json())
                        .then((data) => {
                          // data.features[0].properties.id = parseInt(
                          //   site_Url.match(/\d+/)[0],
                          //   10
                          // );
                          data.features[0].id = parseInt(
                            site_Url.match(/\d+/)[0],
                            10
                          );

 
                          allSiteLayerGroup = L.geoJSON(data, {
                            style: {
                              fillColor: "#803d00",
                              fillOpacity: 0,
                              color: "#803d00",
                              weight: 3,
                            },
                            onEachFeature: onEachSiteFeature,

                          }).addTo(map);

                          var siteLayer = L.geoJSON(data.features, {
                            onEachFeature: onEachSiteLayer,
                          });
                        })
                        .catch((error) =>
                          console.error("Error fetching site data:", error)
                        );
                    });
                 
                
                  
                  })
                  .catch((error) => {
                    console.error("Error:", error);
                  });

                regionLayer = L.geoJSON(All_Regions, {
                  style: {
                    color: "#009879",
                    fillOpacity: mainOpacity,
                    weight: 1,
                  },
                  onEachFeature: onEachRegionFeature,
                }).addTo(map);

                function onEachRegionFeature(feature, layer) {
                  layer.on("click", function (event) {
                    projectInfo(feature.properties.id, "region");
                    regionLayer.resetStyle();
                    event.target.setStyle({
                      color: "#b0d129",
                      fillOpacity: mainOpacity,
                      weight: 5,
                    });
                    map.fitBounds(layer.getBounds());
                    markSelectedRegionInList(feature.properties.name);
                    woredaLayerGroup.clearLayers();
                    drawWoredasForRegion(feature.properties.id);
                    updateWoredaList(feature.properties.id);
                  });

                  function drawWoredasForRegion(selectedRegion) {
                    fetch(
                      `https://tbrr.echnoserve.com/api/geojson/regions/${selectedRegion}/woredas`
                    )
                      .then((response) => response.json())
                      .then((data) => {
                        const Region_Woredas = data.data;
                        Region_Woredas.forEach(function (woro_da) {
                          fetchData(
                            `https://tbrr.echnoserve.com/${woro_da}`
                          ).then((woredaData) => {
                             const WoredaId = parseInt( woro_da.match(/\/([^\/]+)\.geojson$/)[1]);
                             var Woreda_Name;
                             const woreda = Woredas_List.find(woreda => woreda.id === WoredaId);
                                  console.log("nskdhf", Woredas_List)
                             if (woreda) {
                                      Woreda_Name = woreda.name;
                                    }

                              woredaData.features.forEach(feature => {
                                 feature.properties.WoredaId = WoredaId;
                                 feature.properties.Woreda_Name = Woreda_Name
                                });
                                console.log("jhsjdgvsgv",woredaData)
                                L.geoJSON(woredaData, {
                              onEachFeature: onEachWoredaFeature,
                            }).addTo(woredaLayerGroup);
                          });
                        });
                      })
                      .catch((error) => {
                        console.error("Error:", error);
                      });
                  }
                }

                function getLayerByRegionName(regionId) {
                  var selectedLayer = null;
                  regionLayer.eachLayer(function (layer) {
                    if (layer.feature.properties.id === regionId) {
                      selectedLayer = layer;
                    }
                  });
                  return selectedLayer;
                }

                function getLayerByWoredaName(WoredaId) {
                  const Clicked_Layer =  Woredas.find(
                    (layer) => layer.id === WoredaId
                  );
                  return Woredas.find(
                    (layer) => layer.id === WoredaId
                  );
                }

                function getLayerByKebeleName(KebeleId) {

                  return Kebeles.find(
                    (layer) => layer.id === KebeleId
                  );
                }

                function getLayerBySiteName(SiteId) {
                  var THE_SITE = all_Site.find(
                    (LAYER) => LAYER.id === SiteId
                  );
                  return THE_SITE;
                }

                function markSelectedRegionInList(selectedRegion) {
                  var listItems = document.querySelectorAll("li");
                  listItems.forEach(function (item) {
                    if (item.textContent === selectedRegion) {
                      item.classList.remove("active-region");
                      item.classList.add("active-region");
                    } else {
                      item.classList.remove("active-region");
                    }
                  });
                }

                function updateWoredaList(selectedRegion) {
                  var searchInput = document.getElementById("woredaInput");

                  selectWoreda.classList.remove("s-hide");
                  woredaContent.classList.remove("s-hide");
                  woredaList.innerHTML = "<strong>Woredas:</strong>";

                  fetchData(
                    `https://tbrr.echnoserve.com/api/regions/${selectedRegion}/woredas?all=false`
                  ).then((woredaData) => {
                    if (woredaData.data.length === 0) {
                      woredaList.innerHTML = ""
                      woredaList.innerHTML += "<p>No Woreda</p>";
                      } else {
                        woredaList.innerHTML = ""
                      woredaData.data.forEach((Woreda_Data) => {
                      var listItem = document.createElement("li");
                      listItem.textContent = Woreda_Data.woreda_name;
                      listItem.classList.add("woreda-item");
                      listItem.dataset.woredaId = Woreda_Data.id;
                      woredaList.appendChild(listItem);
                      var w = {
                        id: Woreda_Data.id,
                        name: Woreda_Data.woreda_name
                      } 
                      Woredas_List.push(w);
                     
                      listItem.addEventListener("click", function () {
                        if (kebeleList) {
                          
                          kebeleList.style.display = "block";
                        }
                        if (siteList) {
                          siteList.innerHTML = ""
                          siteList.style.display = "none";
                        }

                        var selectedWoredaId = parseInt(this.dataset.woredaId);
                        var W_layer = getLayerByWoredaName(selectedWoredaId);

                        if (W_layer) {
                          map.fitBounds(W_layer.getBounds());
                          W_layer.setStyle({
                            color: "#65c9e1",
                            fillOpacity: 0,
                            weight: 3,
                          });
                          W_layer.fire("click");
                        }

                        // woredaLayerGroup.eachLayer(function (woredaLayer) {
                        //   woredaLayer.setStyle({
                        //     color: "black",
                        //     fillOpacity: 0,
                        //     weight: 1,
                        //   });
                        // });
                        //  W_layer.setAttribute('stroke', '#65c9e1');
                        woredaLayerGroup.eachLayer(function (woredaLayer) {
                          if (
                            woredaLayer.feature &&
                            woredaLayer.feature.properties.id ===
                              W_layer.id
                          ) {
                            woredaLayer.setStyle({
                              color: "#65c9e1",
                              fillOpacity: mainOpacity,
                              weight: 1,
                            });

                            map.fitBounds(woredaLayer.getBounds());
                            // woredaLayer.fire("click");
                          }
                        });

                        if (W_layer !==undefined){
                       drawKebelesForWoreda(W_layer.feature.properties.id);
                      } else {
                        projectInfo(this.dataset.woredaId, "woreda");
                        updateKebeleList(this.dataset.woredaId);
                      }
                         markSelectedWoredaInList(this.textContent);
                        kebeleLayerGroup.clearLayers();
                      });
                    });

                    
                    searchInput.addEventListener("input", function () {
                      var filterValue = searchInput.value.toLowerCase();
                      Array.from(woredaList.getElementsByTagName("li")).forEach(
                        function (listItem) {
                          var woredaName = listItem.textContent.toLowerCase();
                          if (woredaName.indexOf(filterValue) > -1) {
                            listItem.style.display = "";
                          } else {
                            listItem.style.display = "none";
                          }
                        }
                      );
                    });
                  } 
                });

                  showContainer("woredaContainer", "woredaList");
                }

                function drawKebelesForWoreda(selectedWoreda) {
                  fetch(
                    `https://tbrr.echnoserve.com/api/geojson/woredas/${selectedWoreda}/kebeles`
                  )
                    .then((response) => response.json())
                    .then((data) => {
                      const Woroda_Kebeles = data.data;
                      Woroda_Kebeles.forEach(function (KEBELE) {
                        fetchData(`https://tbrr.echnoserve.com${KEBELE}`).then(
                          (woredaData) => {
                            woredaData.id = parseInt(
                                KEBELE.match(/\d+/)[0],
                                10
                              );
                            woredaData.features.forEach((feature) => {
                              feature.properties.id = parseInt(
                                KEBELE.match(/\d+/)[0],
                                10
                              );
                              feature.id = parseInt(
                                KEBELE.match(/\d+/)[0],
                                10
                              );
                            });
                            L.geoJSON(woredaData, {
                              onEachFeature: onEachKebeleFeature,
                            }).addTo(kebeleLayerGroup);

                          }
                        );
                      });
                    })
                    .catch((error) => {
                      console.error("Error:", error);
                    });
                }

                function onEachKebeleFeature(feature, layer) {
                  layer.id = feature.id
                  Kebeles.push(layer);
                  layer.on("click", function () {
                    kebeleLayerGroup.eachLayer(function (kebeleLayer) {
                      kebeleLayer.setStyle({
                        color: "green",
                        fillOpacity: 0,
                        weight: 1,
                      });
                    });
                    console.log("fnsjdfbsjdf",layer)

                    // event.target.setAttribute('stroke', '#e3c172');
                    layer.setStyle({
                      color: "#e3c172",
                      fillOpacity: mainOpacity,
                      weight: 4,
                    });
                    projectInfo(feature.properties.id, "kebele");

                    markSelectedKebeleInList(feature.properties.name);

                    map.fitBounds(layer.getBounds());

                    siteLayerGroup.clearLayers();
                    //  drawSitesForKebele(feature.properties.RK_CODE);
                    //updateSiteList(feature.properties.RK_CODE);
                  });
                }

                function markSelectedKebeleInList(selectedKebele) {
                  var kebeleItems = document.querySelectorAll("#kebeleList li");
                  kebeleItems.forEach(function (item) {
                    var kebeleName = item.textContent.trim();
                    if (kebeleName === selectedKebele) {
                      item.classList.remove("active-kebele");
                      item.classList.add("active-kebele");
                    } else {
                      item.classList.remove("active-kebele");
                    }
                  });
                }

                function updateKebeleList(selectedWoreda) {
                  var searchInput = document.getElementById("kebeleInput");

                  kebeleList.innerHTML = "<strong>Kebeles:</strong>";

                  fetchData(
                    `https://tbrr.echnoserve.com/api/woredas/${selectedWoreda}/kebeles?all=false`
                  ).then((kebeleData) => {
                    if (kebeleData.data.length === 0) {
                      kebeleList.innerHTML = ""
                      kebeleList.innerHTML += "<p>No Keble</p>";
      } else {
                      kebeleList.innerHTML = ""
                      kebeleData.data.forEach((feature) => {
                      var listItem = document.createElement("li");
                      listItem.textContent = feature.kebele_name;
                      kebeleList.appendChild(listItem);

                      listItem.dataset.kebeleName = feature.kebele_name;
                      listItem.dataset.kebeleId = feature.id;
                      listItem.addEventListener("click", function () {
                        if (siteList) {
                          siteList.style.display = "block";
                        }

                        var selectedKebeleId = parseInt(this.dataset.kebeleId);
                        markSelectedKebeleInList(feature.kebele_name);

                        var selectedKebeleId = parseInt(this.dataset.kebeleId);
                        console.log(this,"csdjch",this.dataset.kebeleId)
                        var K_layer = getLayerByKebeleName(selectedKebeleId);

                        if (K_layer) {
                          map.fitBounds(K_layer.getBounds());
                          // K_layer.setStyle({
                          //   color: "green",
                          //   fillOpacity: secondaryOpacity,
                          //   weight: 2,
                          // });
                           K_layer.fire("click")
                        }
                        projectInfo(selectedKebeleId, "kebele");
  

                        kebeleLayerGroup.eachLayer(function (kebeleLayer) {
                          if (
                            kebeleLayer.feature &&
                            kebeleLayer.feature.properties.name ===
                              feature.properties.name
                          ) {
                            kebeleLayer.setStyle({
                              color: "#4CAF50",
                              fillOpacity: secondaryOpacity,
                              weight: 1,
                            });
                          }
                        });

                        siteLayerGroup.clearLayers();
                        drawSitesForKebele(selectedKebeleId.toString());
                        updateSiteList(this.dataset.kebeleId);
                      });
                    });
                  }  });

                  searchInput.addEventListener("input", function () {
                    var filterValue = searchInput.value.toLowerCase();
                    Array.from(kebeleList.getElementsByTagName("li")).forEach(
                      function (listItem) {
                        var kebeleName = listItem.textContent.toLowerCase();
                        if (kebeleName.indexOf(filterValue) > -1) {
                          listItem.style.display = "";
                        } else {
                          listItem.style.display = "none";
                        }
                      }
                    );
                  });

                  showContainer("kebeleContainer", "kebeleList");
                }

                function onEachSiteFeature(feature, layer) {
                  Sites.push(layer);
                  layer.on("click", function () {
                    projectInfo(feature.id, "site");
                    siteLayerGroup.eachLayer(function (siteLayer) {
                      siteLayer.setStyle({
                        color: "#ffd700",
                        fillOpacity: mainOpacity,
                        weight: 1,
                      });
                    });
                    SiteLayerStyle(layer)
                   
                    markSelectedSiteInList(feature.site_name);
                    map.fitBounds(layer.getBounds());

                  });
                }

                function markSelectedSiteInList(selectedSite) {
                  var siteItems = document.querySelectorAll("#siteList li");
                  siteItems.forEach(function (item) {
                    var siteName = item.textContent.trim();
                    if (siteName === selectedSite) {
                      item.classList.remove("active-site");
                      item.classList.add("active-site");
                    } else {
                      item.classList.remove("active-site");
                    }
                  });
                }

                function drawSitesForKebele(selectedkebele) {
                  fetch(
                    `https://tbrr.echnoserve.com/api/geojson/kebeles/${selectedkebele}/sites`
                  )
                    .then((response) => response.json())
                    .then((data) => {
                      const Woroda_Kebeles = data.data;
                      Woroda_Kebeles.forEach(function (SITE) {
                        fetchData(`https://tbrr.echnoserve.com${SITE}`).then(
                          (siteData) => {
                            L.geoJSON(siteData, {
                              onEachFeature: onEachSiteFeature,
                            }).addTo(siteLayerGroup);
                          }
                        );
                      });
                    })
                    .catch((error) => {
                      console.error("Error:", error);
                    });
                }

                function updateSiteList(selectedKebele) {
  var siteList = document.getElementById("siteList");
  siteList.innerHTML = "<strong>Sites:</strong>";

  fetchData(`https://tbrr.echnoserve.com/api/kebeles/${selectedKebele}/sites?all=false`)
    .then((siteData) => {
      if (siteData.data.length === 0) {
        siteList.innerHTML = ""
        siteList.innerHTML += "<p>No Site</p>";
      } else {
          siteData.data.forEach((feature) => {
          siteList.innerHTML = ""
          var listItem = document.createElement("li");
          listItem.textContent = feature.site_name ?? feature.watershed_name;
          listItem.dataset.siteId = feature.id;
          listItem.dataset.name = feature.site_name;
          siteList.appendChild(listItem);

          listItem.addEventListener("click", function () {
            projectInfo(feature.id, "site");
            siteLayerGroup.eachLayer(function (siteLayer) {
              if (
                siteLayer.feature &&
                siteLayer.feature.properties.Name === feature.site_name
              ) {
                siteLayer.setStyle({
                  color: "#ffd790",
                  fillOpacity: secondaryOpacity,
                  weight: 1,
                });
              } else {
                map.fitBounds(siteLayer.getBounds());
                siteLayer.setStyle({
                  color: "#ede99a",
                  fillOpacity: mainOpacity,
                  weight: 1,
                });
              }
            });

            markSelectedSiteInList(feature.site_name);
          });
        });
      }
    });
  showContainer("siteContainer", "siteList");
}


                function onEachWoredaFeature(feature, layer) {
                  layer.id = feature.properties.WoredaId
                  layer.name = feature.properties.Woreda_Name;
                  Woredas.push(layer);
                  layer.bindTooltip(feature.properties.name, {
                    permanent: false,
                    direction: top,
                    fontSize: "16px",
                  });

                  layer.on("click", function () {
                    projectInfo(feature.properties.WoredaId, "woreda");
                    woredaLayerGroup.eachLayer(function (woredaLayer) {
                      woredaLayer.setStyle({
                        color: "black",
                        fillOpacity: thirdOpacity,
                        weight: 1,
                      });
                    
                     });
                     console.log("event.target",event.target)
                    event.target.setAttribute('stroke', '#65c9e1');

                    // event.target.setStyle({
                    //   color: "#b0d129",
                    //   fillOpacity: mainOpacity,
                    //   weight: 5,
                    // });
                    layer.setStyle({
                      color: "#65c9e1",
                      fillOpacity: mainOpacity,
                      weight: 3,
                    });

                    markSelectedWoredaInList(feature.properties.Woreda_Name);

                    map.fitBounds(layer.getBounds());

                    kebeleLayerGroup.clearLayers();
                    drawKebelesForWoreda(feature.properties.WoredaId);
                    updateKebeleList(feature.properties.WoredaId);
                  });
                }

                function markSelectedWoredaInList(selectedWoreda) {
                  var woredaItems = document.querySelectorAll("#woredaList li");
                  woredaItems.forEach(function (item) {
                    var woredaName = item.textContent.trim();
                    if (woredaName === selectedWoreda) {
                      item.classList.remove("active-woreda");
                      item.classList.add("active-woreda");
                    } else {
                      item.classList.remove("active-woreda");
                    }
                  });
                }
              }
            );
          });
        })
        .catch((error) => {
          console.error("Error:", error);
        });

      var Zoom_Out = document.getElementById("Zoom_Out");
      Zoom_Out.addEventListener("click", function () {
        map.setView(ethiopia, 7);
      });

      async function RegionData(id) {
        try {
          const response = await fetch(
            `https://tbrr.echnoserve.com/api/regions/${id}`
          );
          const data = await response.json();
          return data.data;
        } catch (error) {
          console.error("Error fetching data:", error);
          return "No Data"
          throw error;
        }
      }

      async function Woreda_Data(id) {
        try {
          const response = await fetch(
            `https://tbrr.echnoserve.com/api/woredas/${id}`
          );
          const data = await response.json();
          return data.data;
        } catch (error) {
          console.error("Error fetching data:", error);
          return "No Data"
          throw error;
        }
      }

      async function Kebele_Data(id) {
        try {
          const response = await fetch(
            `https://tbrr.echnoserve.com/api/kebeles/${id}`
          );
          const data = await response.json();
          return data.data;
        } catch (error) {
          console.error("Error fetching data:", error);
          return "No Data"
          throw error;
        }
      }

      async function Site_Data(id) {
        try {
          const response = await fetch(
            `https://tbrr.echnoserve.com/api/sites/${id}`
          );
          const data = await response.json();
          return data.data;
        } catch (error) {
          console.error("Error fetching data:", error);
          return "No Data"
          throw error;
        }
      }

      async function Get_Coordinates(geoJSON) {
        try {
          const response = await fetch(`https://tbrr.echnoserve.com${geoJSON}`);
          const data = await response.json();
          return data.features[0].geometry.coordinates[0][0];
        } catch (error) {
          return "No Coordinate";
          throw error;
        }
      }
      async function projectInfo(id, type) {
        const projectInfoDiv = document.getElementsByClassName("projectInfo");

        const loadingAnimation = `
        <div class="loading-spinner d-flex justify-content-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="60" height="200" style="shape-rendering: auto; display: block; background: transparent;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="10" stroke="#00604a" fill="none" cy="50" cx="50">
            <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
          </circle><g></g></g></svg>
        </div>
    `;

        for (let i = 0; i < projectInfoDiv.length; i++) {
          projectInfoDiv[i].innerHTML = loadingAnimation;
        }
        let content = "";

        const renderTableRows = (rows) =>
          rows
            .map(
              (row) => `
        <tr>
            <td class="border px-4 py-2 font-bold render-label">${row.label}</td>
            <td class="border px-4 py-2 render-value">${row.value}</td>
        </tr>
    `
            )
            .join("");

        const resourceTables = (resources, resourceName) => `
                <p class = "render-label">${resourceName}</p>
                <hr />

                <table class="table-auto w-full">
                    <tbody>${resources
                      .map(
                        (resource, index) => `
                        <tr key=${index}>
                            <td class="border px-4 py-2 font-bold render-label">${resource.value}</td>
                            <td class="border px-4 py-2 render-value">${resource.amount}</td>
                        </tr>
                    `
                      )
                      .join("")}</tbody>
                </table>
                <hr />
            `;

        try {
          if (type === "region") {
            GEO.innerHTML = ""
            const regionData = await RegionData(id);
            const rows = [
              { label: "Region Name", value: regionData.region_name },
              { label: "Number of Sites", value: regionData.sites },
              { label: "Number of Kebeles", value: regionData.kebeles.length },
              { label: "Number of Woredas", value: regionData.woredas.length },
            ];

            content = `
                <h4>${regionData.region_name}</h4>
                <hr />
                <table class="table-auto w-full">
                    <tbody>${renderTableRows(rows)}</tbody>
                </table>
            `;
          } else if (type === "woreda") {
    const woredaData = await Woreda_Data(id);
    if (woredaData.geojson) {
      GEO.innerHTML = ""
    }
    else {
      GEO.textContent = "No shape file"
    }
    const dataRows = [
        {
            label: "Female Population",
            value: woredaData.woreda_data?.female_population !== undefined && woredaData.woreda_data?.female_population !== null ? woredaData.woreda_data.female_population : "No data",
        },
        {
            label: "Male Population",
            value: woredaData.woreda_data?.male_population !== undefined && woredaData.woreda_data?.male_population !== null ? woredaData.woreda_data.male_population : "No data",
        },
        {
            label: "Rural Kebeles",
            value: woredaData.woreda_data?.rural_kebeles !== undefined && woredaData.woreda_data?.rural_kebeles !== null ? woredaData.woreda_data.rural_kebeles : "No data",
        },
        {
            label: "Urban Kebeles",
            value: woredaData.woreda_data?.urban_kebeles !== undefined && woredaData.woreda_data?.urban_kebeles !== null ? woredaData.woreda_data.urban_kebeles : "No data",
        },
    ];

    content = `
        <h4>${woredaData.woreda_name}</h4>
        <hr />
         <p class = "render-label">Woreda information:</p>

        <table class="table-auto w-full">
            <tbody>${renderTableRows([
                {
                    label: "Woreda Name",
                    value: woredaData.woreda_name !== undefined && woredaData.woreda_name !== null ? woredaData.woreda_name : "No data",
                },
                {
                    label: "Region Name",
                    value: woredaData.region_name !== undefined && woredaData.region_name !== null ? woredaData.region_name : "No data",
                },
                {
                    label: "Zone Name",
                    value: woredaData.zone_name !== undefined && woredaData.zone_name !== null ? woredaData.zone_name : "No data",
                },
            ])}</tbody>
        </table>
        <hr/>
        <p class = "render-label">Woreda Data</p>
        <hr/>
        <table class="table-auto w-full">
            <tbody>${renderTableRows(dataRows)}</tbody>
        </table>
        <hr />
        <p class = "render-label">Woreda Resource</p>
        <hr />
        ${woredaData.woreda_resource.length !== 0 ? `
            ${woredaData.woreda_resource?.LAND ? resourceTables(woredaData.woreda_resource.LAND, "LAND") : 
            `<p class = "render-label">Land</p>
                <hr />
                <p class = 'render-value'>No Data</p>`
            }
            ${woredaData.woreda_resource?.ROAD ? resourceTables(woredaData.woreda_resource.ROAD, "ROAD") :
            `<p class = "render-label">ROAD</p>
                <hr />
                <p class = 'render-value'>No Data</p>`
            }
        ` : "<p class = 'render-value'>No Resource data</p>"}
        <hr />
        <p class = "render-label">Woreda Institution</p>
        <hr />
        ${woredaData.woreda_institution.length !== 0 ? `
            ${woredaData.woreda_institution?.SCHOOL ? resourceTables(woredaData.woreda_institution.SCHOOL, "School") :
            
            `<p class = "render-label">School</p>
                <hr />
                <p class = 'render-value'>No Data</p>`}
            ${woredaData.woreda_institution?.HEALTH_FACILITY ? resourceTables(woredaData.woreda_institution.HEALTH_FACILITY, "Health Facility") :
            `<p class = "render-label">Health Facility</p>
                <hr />
                <p class = 'render-value'>No Data</p>`
                 }
        ` : "<p class = 'render-value'>No Institution data</p>"}
    `;
}
else if (type === "site") {
  GEO.innerHTML = ""
    const siteData = await Site_Data(id);
    const coordinates = await Get_Coordinates(siteData.geojson);
    if (siteData.geojson) {
      GEO.innerHTML = ""
    }
    else {
      GEO.textContent = "No shape file"
    }
    const formatResource = (resourceArray, label) => {
        if (resourceArray && resourceArray.length > 0) {
            return resourceArray.map((item, index) => `
                <div key=${index}>
                    <p class="border px-4 py-2 font-bold render-value">${item.value}</p>
                </div>
            `).join("");
        }
        return `<p class="border px-4 py-2 render-value">No ${label} data</p>`;
    };

    const formatTreeResource = (resourceArray, filterCondition, label) => {
        if (resourceArray && resourceArray.length > 0) {
            const filteredArray = resourceArray.filter(filterCondition);
            if (filteredArray.length > 0) {
                return filteredArray.map((item, index) => `
                    <div key=${index}>
                        <p class="border px-4 py-2 font-bold render-value">${item.value}</p>
                    </div>
                `).join("");
            }
        }
        return `<p class="border px-4 py-2 render-value">No ${label} data</p>`;
    };

    const renderLandUse = () => {
        const landData = siteData.resources.find(resource => resource.LAND && resource.LAND.length > 0);
        return landData ? formatResource(landData.LAND, "land") : `<p class="border px-4 py-2 render-value">No land data</p>`;
    };

    const renderIndigenousTrees = () => {
        const treeData = siteData.resources.find(resource => resource.TREE && resource.TREE.some(tree => tree.indigenous === 1));
        return treeData ? formatTreeResource(treeData.TREE, tree => tree.indigenous === 1, "indigenous tree") : `<p class="border px-4 py-2 render-value">No indigenous tree data</p>`;
    };

    const renderExoticTrees = () => {
        const treeData = siteData.resources.find(resource => resource.TREE && resource.TREE.some(tree => !tree.hasOwnProperty("indigenous")));
        return treeData ? formatTreeResource(treeData.TREE, tree => !tree.hasOwnProperty("indigenous"), "exotic tree") : `<p class="border px-4 py-2 render-value">No exotic tree data</p>`;
    };

    const renderLivestock = () => {
        const livestockData = siteData.resources.find(resource => resource.LIVESTOCK && resource.LIVESTOCK.length > 0);
        return livestockData ? formatResource(livestockData.LIVESTOCK, "livestock") : `<p class="border px-4 py-2 render-value">No livestock data</p>`;
    };

    const renderForage = () => {
        const forageData = siteData.resources.find(resource => resource.FORAGE && resource.FORAGE.length > 0);
        return forageData ? formatResource(forageData.FORAGE, "forage") : `<p class="border px-4 py-2 render-value">No forage data</p>`;
    };

    content = `
        <h4>${siteData.site_name || siteData.watershed_name}</h4>
        <hr />
        <p class = "render-label">Site Information</p>
        <p class = "render-value"><strong class = "render-label">Size in Ha.: </strong> ${siteData.size_ha ?? "No data"}</p>
        <p class = "render-value"><strong class = "render-label">Watershed: </strong> ${siteData.watershed_name ?? "No data"}</p>
        <p class = "render-value"><strong class = "render-label">Kebele: </strong> ${siteData.kebele_name ?? "No data"}</p>
        <p class = "render-value"><strong class = "render-label">Woreda: </strong> ${siteData.woreda_name || "No data"}</p>
        <p class = "render-value"><strong class = "render-label">Zone: </strong> ${siteData.zone_name || "N/A"}</p>
        <p class = "render-label">Site Resource</h4>
        <hr />
        ${siteData.resources && siteData.resources.length > 0 ? `
            <p class = "render-label">Current land use</p>
            <hr />
            ${renderLandUse()}
            <p class="text-xl render-label">TREE</p>
            <hr />
            <p class="font-bold render-label">Indigenous Tree</p>
            ${renderIndigenousTrees()}
            <p class="font-bold render-label">Exotic Tree</p>
            <hr />
            ${renderExoticTrees()}
            <p class = "render-label">LIVESTOCK</p>
            <hr />
            ${renderLivestock()}
            <p class = "render-label">FORAGE</p>
            <hr />
            ${renderForage()}
        ` : "<p class = 'render-value'>No Resource data Entered</p>"}
        <hr />
        <p class = "render-label">Coordinates</p>
        <hr />
        ${coordinates === "No Coordinate" ? `
            <p class="border px-4 py-2 font-bold render-value">No Coordinate</p>
        ` : `
            <table class="table-auto w-full">
                <thead>
                    <tr>
                        <th class = "render-label">Latitude</th>
                        <th class = "render-label">Longitude</th>
                    </tr>
                </thead>
                <tbody>
                    ${coordinates.map((coords, index) => `
                        <tr key=${index}>
                            <td class="border px-4 py-2 font-bold render-value">${coords[0]}</td>
                            <td class="border px-4 py-2 render-value">${coords[1]}</td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
        `}
    `;
}

else if (type === "kebele") {
    const kebeleData = await Kebele_Data(id);

    if (kebeleData.geojson) {
      GEO.innerHTML = ""
    }
    else {
      GEO.textContent = "No shape file"
    }
    const getDataValue = (data, key) => 
        data && data.hasOwnProperty(key) && data[key] !== undefined && data[key] !== null ? data[key] : 'No Data';

    const dataRows = [
        { label: "Female Population", value: getDataValue(kebeleData.kebele_data, 'female_population') },
        { label: "Male Population", value: getDataValue(kebeleData.kebele_data, 'male_population') },
        { label: "Female Non-Employed", value: getDataValue(kebeleData.kebele_data, 'female_non_employed') },
        { label: "Male Non-Employed", value: getDataValue(kebeleData.kebele_data, 'male_non_employed') },
        { label: "MHF Land Owners", value: getDataValue(kebeleData.kebele_data, 'mhf_land_owners') },
        { label: "FHF Land Owners", value: getDataValue(kebeleData.kebele_data, 'fhf_land_owners') },
        { label: "MHF Land Lease", value: getDataValue(kebeleData.kebele_data, 'mhf_land_lease') },
        { label: "FHF Land Lease", value: getDataValue(kebeleData.kebele_data, 'fhf_land_lease') },
    ];

    const resourceTables = (resources, resourceName) => {
        if (!Array.isArray(resources) || resources.length === 0) return `
             <p class = "render-label">${resourceName}</p>
            <hr />
        <p>No ${resourceName} data</p>`;

        const hasAmount = resources.some(resource => resource.amount !== undefined);
        const hasCapacity = resources.some(resource => resource.capacity !== undefined);

        return `
            <p class = "render-label">${resourceName}</p>
            <hr />
            <table class="table-auto w-full">
                <thead>
                    <tr>
                        <th class="px-4 py-2"></th>
                        ${hasAmount ? '<th class="px-4 py-2 font-bold text-lg render-label">Amount</th>' : ""}
                        ${hasCapacity ? '<th class="px-4 py-2 font-bold text-lg render-label">Capacity</th>' : ""}
                    </tr>
                </thead>
                <tbody>
                    ${resources.map((resource, index) => `
                        <tr key=${index}>
                            <td class="border px-4 py-2 font-bold render-label">${resource.value}</td>
                            ${hasAmount ? `<td class="border px-4 py-2 render-value">${resource.amount || "No data"}</td>` : ""}
                            ${hasCapacity ? `<td class="border px-4 py-2 render-value">${resource.capacity || "No data"}</td>` : ""}
                        </tr>
                    `).join("")}
                </tbody>
            </table>
            <hr />
        `;
    };

    const livelihoodTable = (livelihoods) => {
        if (!Array.isArray(livelihoods) || livelihoods.length === 0) {
            return `
                        <p class = "render-label">Livelihoods<p>
            <hr />
            <p class="border px-4 py-2 render-value">No livelihoods data</p>`;
        }

        return `
            <p class = "render-label">Livelihoods</p>
            <hr />
            <table class="table-auto w-full">
                <thead>
                    <tr>
                        <th class=" px-4 py-2 font-bold text-lg render-label">Type</th>
                        <th class=" px-4 py-2 font-bold text-lg render-label">Male Headed HH</th>
                        <th class=" px-4 py-2 font-bold text-lg render-label">Female Headed HH</th>
                    </tr>
                </thead>
                <tbody>
                    ${livelihoods.map((livelihood, index) => `
                        <tr key=${index}>
                            <td class="border px-4 py-2 render-value font-bold">${livelihood.value}</td>
                            <td class="border px-4 py-2 render-value">${livelihood.male_headed_hh || "No data"}</td>
                            <td class="border px-4 py-2 render-value">${livelihood.female_headed_hh || "No data"}</td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
            <hr />
        `;
    };

    const energyResourcesTable = (energy_resources) => {
        if (!Array.isArray(energy_resources) || energy_resources.length === 0) {
            return `
           <p class = "render-label">Energy Resources</p>
            <hr />
            <p class="border px-4 py-2 render-value">No energy resources data</p>`;
        }

        return `
            <p class = "render-label">Energy Resources</p>
            <hr />
            <table class="table-auto w-full">
                <thead>
                    <tr>
                        <th class="px-4 py-2 font-bold text-lg render-label">Type</th>
                        <th class="px-4 py-2 font-bold text-lg render-label">Access Level</th>
                    </tr>
                </thead>
                <tbody>
                    ${energy_resources.map((resource, index) => `
                        <tr key=${index}>
                            <td class="border px-4 py-2 font-bold render-label">${resource.value}</td>
                            <td class="border px-4 py-2 render-value">${resource.access_level}</td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
            <hr />
        `;
    };

    const renderResourceTables = (resources) => {
        if (!Array.isArray(resources)) return "";

        return resources.map(resourceObj => {
            const resourceType = Object.keys(resourceObj)[0];
            if (resourceType === "TREE") {
                const indigenousTrees = resourceObj[resourceType].filter(tree => tree.indigenous);
                const exoticTrees = resourceObj[resourceType].filter(tree => !tree.indigenous);
                return `
                    ${resourceTables(indigenousTrees, "Indigenous Trees")}
                    ${resourceTables(exoticTrees, "Exotic Trees")}
                `;
            } else {
                return resourceTables(resourceObj[resourceType], resourceType);
            }
        }).join("");
    };

    const renderTableRows = (rows) => {
        return rows.map(row => `
            <tr>
                <td class="border px-4 py-2 font-bold render-label">${row.label}</td>
                <td class="border px-4 py-2 render-value">${row.value}</td>
            </tr>
        `).join("");
    };

    content = `
        <h4>${kebeleData.kebele_name}</h4>
        <hr />
          <p class = "render-label">Kebele information:</p>
        <table class="table-auto w-full">
            <tbody>
                ${renderTableRows([
                    { label: "Region Name", value: kebeleData.region_name !== undefined && kebeleData.region_name !== null ? kebeleData.region_name : "No Data" },
                    { label: "Woreda Name", value: kebeleData.woreda_name !== undefined && kebeleData.woreda_name !== null ? kebeleData.woreda_name : "No Data" },
                    { label: "Zone Name", value: kebeleData.zone_name !== undefined && kebeleData.zone_name !== null ? kebeleData.zone_name : "No Data" },
                ])}
            </tbody>
        </table>
        <hr/>
        <p class = "render-label">Kebele Data</p>
        <hr/>
        <table class="table-auto w-full">
            <tbody>${renderTableRows(dataRows)}</tbody>
        </table>
        <hr />
        ${renderResourceTables(kebeleData.resources)}
        ${livelihoodTable(kebeleData.livelihoods)}
        ${energyResourcesTable(kebeleData.energy_sources)}
    `;
}

          for (let i = 0; i < projectInfoDiv.length; i++) {
            projectInfoDiv[i].innerHTML = content;
          }
        } catch (error) {
          console.error("Error:", error);
        }
      }

      function showContainer(containerId, listId) {
        var container = document.getElementById(containerId);
        var list = document.getElementById(listId);

        if (container && list && list.children.length > 0) {
          container.style.display = "block";
        } else {
          container.style.display = "none";
        }
      }
    </script>
  </body>
</html>
